---
title: 規劃資料倉儲遷移
description: 瞭解資料倉儲遷移的最佳作法、核心資料倉儲遷移程式步驟，以及每個步驟中的工作。
author: v-hanki
ms.author: janet
ms.date: 06/24/2020
ms.topic: conceptual
ms.service: cloud-adoption-framework
ms.subservice: plan
ms.openlocfilehash: 24251d19a94af8a53c2fbd2e8ae2e5116d9812f3
ms.sourcegitcommit: 9163a60a28ffce78ceb5dc8dc4fa1b83d7f56e6d
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/17/2020
ms.locfileid: "86451813"
---
<!-- cSpell:ignore Informatica gzipped Attunity -->

# <a name="plan-a-data-warehouse-migration"></a>規劃資料倉儲遷移

資料倉儲遷移是任何公司的挑戰。 為了順利執行，並避免任何不受歡迎的意外和非規劃成本，您必須徹底研究挑戰、降低風險，並規劃您的遷移，以確保您的工作盡可能就緒。 概括而言，您的計畫應涵蓋核心資料倉儲遷移程式步驟和其中的任何工作。 主要的處理步驟如下：

- 預先遷移準備
- 遷移策略和執行
- 移轉後

例如，準備工作包括將您的資料倉儲遷移小組納入技能訓練和技術熟悉等。 其中還包括設定概念證明實驗室、瞭解您將如何管理測試和生產環境、取得適當的時間來遷移您的資料和公司防火牆外部的生產系統，以及在資料中心內設定遷移軟體，以讓遷移繼續進行。

為了讓資料倉儲遷移順利進行，您的計畫應該清楚地瞭解：

- 您的商業個案，包括其驅動程式、商業優勢和風險。
- 遷移小組角色和責任。
- 啟用成功遷移所需的技能集和訓練。
- 已配置完成完整遷移的預算。
- 您的遷移策略。
- 如何避免遷移專案中的風險，以避免延遲或重新修改。
- 您現有的資料倉儲系統、其架構、架構、資料磁片區、資料流程、安全性和操作相依性。
- 現有內部部署資料倉儲 DBMS 和 Azure Synapse 之間的差異，例如資料類型、SQL 函數、邏輯和其他考慮。
- 需要遷移的內容和優先順序。
- 遷移工作、方法、順序和期限。
- 控制遷移的方式。
- 如何防止使用者在進行遷移時中斷。
- 您需要在內部部署執行的動作，以避免延遲並啟用遷移。
- 可將架構、資料和 ETL 處理的安全遷移至 Azure 的工具。
- 在遷移期間和之後所需的資料模型設計變更。
- 任何預先遷移或遷移後的技術會有所變更，以及如何將返工降至最低。
- 遷移後技術已淘汰。
- 您將如何實行測試和品質保證以證明成功。
- 您要評估進度並啟用決策的檢查點。
- 萬一發生問題，您的應變計劃和回復點。

為了達成這項瞭解，我們必須在開始進行任何遷移之前準備和開始特定的活動。 讓我們來看看這需要更多的細節。

## <a name="pre-migration-preparation"></a>預先遷移準備

在您開始資料倉儲遷移之前，應該先解決幾件事。

### <a name="key-roles-in-a-data-warehouse-migration-team"></a>資料倉儲遷移小組中的重要角色

遷移專案中的主要角色包括：

- 企業主
- 專案經理（具有 agile 方法體驗，例如 Scrum）
- 專案協調員
- 雲端工程師
- 資料庫管理員（現有的資料倉儲 DBMS 和 Azure Synapse）
- 資料建模者
- ETL 開發人員
- 資料虛擬化專家（可能是 DBA）
- 測試工程師
- 商務分析師（協助測試 BI 工具查詢、報表和分析）

此外，小組需要您的內部部署基礎結構小組支援。

### <a name="skills-and-training-to-ready-the-team-for-migration"></a>準備團隊以進行遷移的技能和訓練

關於技能，在資料倉儲遷移方面，專業知識很重要。 因此，請確定您遷移小組的適當成員已在 Azure 雲端基礎、Azure Blob 儲存體、Azure Data Lake Storage、Azure 資料箱、ExpressRoute、Azure 身分識別管理、Azure Data Factory 和 Azure Synapse 中定型。 當您從現有的資料倉儲進行遷移之後，您的資料建模者很可能需要微調您的 Microsoft Azure Synapse 資料模型。

### <a name="assessing-your-existing-data-warehouse"></a>評估現有的資料倉儲

準備遷移的另一個部分是需要完整評估現有的資料倉儲，以充分瞭解架構、資料存放區、架構、商務邏輯、資料流程、使用 DBMS 功能、倉儲作業和相依性。 這裡提供更多的瞭解。 有關系統運作方式的詳細知識，有助於溝通和涵蓋所有基底。

評量的目的不只是為了確保對整個遷移小組的目前設定有詳細的瞭解，同時瞭解目前設定中的優缺點。 因此，評估目前資料倉儲的結果，可能會影響您的轉移策略，就像您的增益和轉移，而不是更廣泛的工作。 例如，如果評量的結果是您的資料倉儲在生命週期結束，那麼很明顯地，策略就是將資料移轉至 Azure Synapse 上新設計的資料倉儲，以及隨即轉移的方法。

### <a name="on-premises-preparation-for-data-migration"></a>資料移轉的內部部署準備工作

除了為您的目標環境準備和準備您的遷移小組，以及評估目前的設定之外，也請務必在內部部署中設定動作，因為生產資料倉儲通常會受到 IT 程式和核准程式的高度控制。 若要避免延遲，請確定您的資料中心基礎結構和作業小組已準備好將您的資料、架構、ETL 作業等遷移至 Azure 雲端。 資料移轉可以透過下列方式進行：

- AzCopy 至 Azure Blob 儲存體。
- Microsoft Azure ExpressRoute 將壓縮的資料直接傳輸到 Azure。
- 檔案匯出至 Microsoft Azure 資料箱。

影響所選選項的主要因素包括：資料磁片區大小（tb）和網路速度（以 Mbps 為單位）。 需要進行計算，以判斷透過網路遷移資料所需的時間，考慮資料可能會在資料倉儲中壓縮，並在您匯出時變成未壓縮。 這種情況可能會使資料傳送速率變慢。 使用上述任何方法移動資料時，透過 Gzip 重新壓縮資料。 PolyBase 可以直接處理 gzipped 資料。
大型資料磁片區可能會透過 Azure 資料箱遷移（如果移動資料需要太長的時間）。

此外，若要讓 Azure Data Factory 控制從 Azure 匯出現有資料倉儲資料的執行，必須在您的資料中心內安裝自我裝載整合執行時間軟體，才能繼續進行遷移。 基於這些需求，如果需要正式核准才能達成此目的，則及早啟動適當的核准程式以讓這種情況發生，有助於避免行停機。

### <a name="azure-preparation-for-schema-and-data-migration"></a>適用于架構和資料移轉的 Azure 準備

就 Azure 端的準備工作而言，必須透過 Microsoft Azure ExpressRoute 或 Microsoft Azure 資料箱來管理資料匯入。 Azure Data Factory 管線是將資料載入 Azure Blob 儲存體，然後使用 PolyBase 從該處載入至 Azure Synapse 的理想方式。 因此，需要在 Azure 端進行準備，才能開發這類管線。

替代方案是在支援 Azure Synapse 的情況下，在 Azure 上使用您現有的 ETL 工具，這表示在 Azure 上設定工具，從 Azure Marketplace 並準備管線以匯入您的資料，並將其載入至 Azure Blob 儲存體。

## <a name="defining-a-migration-strategy"></a>定義遷移策略

### <a name="migration-goals"></a>移轉目標

在任何策略中，都必須定義一組目標或目標，以表示成功。 然後，可以設定目標，以達成這些目標，並讓使用者獲得責任。 下表顯示遷移目標的範例，以及在雲端資料倉儲遷移專案中設定目標的對應計量：

目標和度量範例的類型：

#### <a name="improve-overall-performance"></a>提升整體效能

- 資料移轉效能
- ELT 效能
- 資料載入效能
- 複雜的查詢效能
- 並行使用者數目

#### <a name="run-at-lower-cost"></a>以較低的成本執行

- 依工作負載計算的成本，例如，每小時的計算時數 x 成本：
  - 標準報告
  - 特定查詢
  - Batch ELT 處理
- 儲存體成本（預備、生產資料表、索引、暫存空間）

#### <a name="operate-with-better-availability-and-service-levels"></a>以更佳的可用性和服務等級操作

- 服務等級協定
- 高可用性

#### <a name="improve-productively"></a>有效率地提升

- 自動化工作，降低系統管理人員人數

因此，成功的資料倉儲遷移可視為資料倉儲，其執行速度會快速或更快，且成本會低於您所遷移的舊版系統。 指派這些目標的擁有者，會產生責任以達成他們。 它也可確保測試概念證明實驗室（如本指南的「刪除風險」一節中所定義）將會被視為成功。

### <a name="migration-approach"></a>遷移方法

您有數個策略選項可將現有的資料倉儲遷移至 Azure Synapse：

- 依原樣隨即轉移現有的資料倉儲。
- 簡化現有的資料倉儲，然後加以遷移。
- 在 Azure Synapse 上完全重新設計您的資料倉儲，並遷移您的資料。

評估現有資料倉儲的結果應該會大幅影響您的策略。 良好的評量結果可能會建議隨即轉移策略。 由於低彈性評等的中等結果可能表示在遷移之前需要簡化。 結果不佳可能表示需要進行完整的重新設計。

隨即轉移讓您的架構保持原樣，嘗試將移動現有系統的工作減至最少。 如果您現有的 ETL 工具已支援 Azure Synapse，您可以最輕鬆地變更目標。 不過，資料表類型、資料類型、SQL 函數、視圖、預存程式商務邏輯等各有差異。此遷移系列中的較低層級檔會詳細說明這些差異和其周圍的方式。

在遷移之前簡化現有的資料倉儲，是為了簡化遷移的複雜性。 它可能包括：

- 在遷移之前移除或封存未使用的資料表，以避免遷移未使用的資料。
- 使用資料虛擬化軟體將實體資料超市轉換成虛擬資料超市，以減少您必須遷移的內容。 轉換也會改善彈性並降低擁有權總成本，因此在遷移期間可以將其視為現代化。

您也可以先簡化，然後隨即轉移剩餘的內容。

### <a name="migration-scope"></a>移轉範圍

無論您選擇哪一種策略，您都應該清楚地定義遷移的範圍、要遷移的內容，以及您是要一次進行累加或全部遷移。 增量遷移的其中一個範例是先遷移您的資料超市，然後再進行您的資料倉儲。 這種方法可讓您專注于高優先順序的商務領域，同時讓您的團隊在個別遷移資料倉儲之前，以累加方式建立專業知識。

### <a name="defining-what-has-to-be-migrated"></a>定義必須遷移的內容

清查所有需要遷移的專案。 這包括架構、資料、ETL 進程（管線）、授權許可權、使用者、BI 工具的語義存取層，以及分析應用程式。 在此系列的每個較低層級的遷移文章中，會提供有關遷移清查之內容的詳細瞭解。 這些連結如下所示。

- 架構遷移、設計和效能考慮。
- 資料移轉、ETL 處理和負載。
- 存取安全性和資料倉儲作業。
- 視覺效果和報表的遷移。
- 將 SQL 問題的影響降至最低。
- 可協助您進行資料倉儲遷移的協力廠商工具。

如果您不確定最佳方法，請在概念證明實驗室中進行測試，以找出最佳的技巧。 如需詳細資訊，請參閱取消風險資料倉儲遷移專案的一節。

### <a name="migration-control"></a>遷移控制

將資料倉儲遷移至 Azure Synapse 牽涉到需要執行的工作：

- 內部部署，例如資料匯出。
- 在網路上，例如 [資料傳輸]。
- 在 Azure 雲端中，例如資料轉換、整合和載入。

問題在於，如果腳本和公用程式都是在內部部署和 Azure 環境中獨立開發、測試和執行，則管理這些工作可能會很複雜。 它會增加複雜性，特別是在版本控制、測試管理和遷移執行不協調的情況下。

您應該避免這些複雜性，並透過原始檔控制存放庫從常見的位置控制它們，以管理從開發到測試和生產環境的變更。 遷移執行將包含需要在內部部署、網路上和 Azure 中執行的工作。 因為 Azure Synapse 是目標環境，所以控制從 Azure 執行的遷移可簡化管理工作。 使用 Azure Data Factory （ADF）來建立遷移控制管線，以控制內部部署和 Azure 上的執行。 這會引進自動化並將錯誤降至最低。 ADF 會成為一種「遷移協調流程」工具，而不只是企業資料整合工具。

控制可從在 Azure 上執行的 Microsoft 合作夥伴取得的其他選項包括資料倉儲自動化工具，可嘗試自動進行遷移。 例如，WhereScape 和 Attunity 等廠商。 這些自動化工具大多是針對遷移的隨即轉移方法。 就算如此，這類工具可能不會支援某些專案，例如預存程式。 這些產品和其他幾項功能會在專門提供協力廠商工具的個別指南中詳細說明，以協助您遷移至 Azure Synapse。

### <a name="migration-testing"></a>遷移測試

測試的第一件事是定義一系列的測試，以及每個需要執行來驗證和表示成功的測試所需的結果集。 請務必確保所有層面都經過測試，並在您現有和遷移的系統之間進行比較，包括：

- 結構描述
- 必要時轉換的資料類型
- 在 Azure Synapse 中使用使用者定義的架構來區分資料倉儲和資料超市資料表
- 使用者
- 使用者對這些角色的角色和指派
- 資料存取安全性許可權
- 資料隱私權與合規性
- 控制系統管理功能的許可權
- 資料品質和完整性
- 將 Azure Synapse 填入資料倉儲，以及從資料倉儲擴展到任何資料超市的 ETL 處理，包括測試
- 所有資料表中的所有資料列都是正確的，包括歷程記錄
- 緩時變維度處理
- 變更資料捕獲處理
- 使用跨系統可能不同之函數的計算和匯總
- 所有已知查詢、報表和儀表板的結果
- 效能和延展性
- 分析功能
- 新的隨用隨付環境中的成本

盡可能地自動化測試，讓每個測試都可重複使用，並啟用一致的方法來評估結果。 如果報表和儀表板不一致，則在進行遷移測試時，能夠比較原始和遷移系統中的中繼資料歷程，是很重要的，因為它可以反白顯示差異，並找出它們在不容易偵測到的位置。

安全地執行此動作的最佳方式是建立角色、將存取權限指派給角色，然後將使用者附加至角色。 若要存取新遷移的資料倉儲，請設定自動化程式來建立新的使用者，並指派角色。 請執行相同動作，從角色中移除使用者。

將切換動作傳達給所有使用者，讓他們知道變更的內容和預期的內容。

## <a name="de-risking-your-data-warehouse-migration-project"></a>取消風險資料倉儲遷移專案

資料倉儲遷移的另一個重要因素是將專案的風險刪除，以充分發揮成功的可能性。 有幾件事可以完成，以消除資料倉儲遷移的風險。 其中包括：

- 建立概念證明實驗室可讓您的小組試用、進行測試、瞭解任何問題，以及找出可協助驗證遷移方法的修正和優化，以改善效能和降低成本。 它也可協助您建立自動化工作的方式、使用內建工具和組建範本來捕捉最佳做法、從經驗中學習，以及追蹤學習到的經驗。 這是降低風險並提高您成功機率的一種方法。 此外，您可以將擁有者指派給負責達到遷移策略所定義之整合目標和目標的測試。
- 在 BI 工具與您的資料倉儲和資料超市之間引進資料虛擬化。 使用資料虛擬化引進使用者透明度，以降低資料倉儲遷移的風險，並使用資料虛擬化 BI 工具隱藏使用者的遷移，如下圖所示。

![資料倉儲遷移圖表](../_images/data-warehouse-migration.png)

其目的是要打破使用自助 BI 工具的商務使用者與所要遷移之基礎資料倉儲和資料超市的實體架構之間的相依性。 藉由引進資料虛擬化，在資料倉儲和資料超市遷移至 Azure Synapse （例如為了優化效能）期間所做的任何架構替代，都可以在商務使用者中隱藏，因為他們只會存取資料虛擬化層中的虛擬資料表。 如果需要結構化變更，則只需要變更資料倉儲或資料超市與任何虛擬資料表之間的對應，使用者就不會察覺到這些變更，也不會察覺到遷移。

- 在資料倉儲遷移之前，請先將任何已識別為從未使用的現有資料表封存起來，因為不會有任何未使用的點遷移資料表。 其中一個可能的方法是將未使用的資料封存到 Azure blob 儲存體，Azure Data Lake 或在 Azure Synapse 中為該資料建立外部資料表，使其仍在線上。
- 請考慮使用在此 VM 上執行的現有舊版資料倉儲 DBMS 的開發版本（通常是免費），在 Azure 上引進虛擬機器（VM）的可能性。 這可讓您快速地將現有的資料倉儲架構移至 VM，並將其移至 Azure Synapse，同時完全在 Azure 雲端上運作。
- 定義遷移順序和相依性。
- 請確定您的基礎結構和作業小組已準備好儘早將資料移轉到遷移專案。
- 找出 DBMS 功能的差異，以及專屬商務邏輯可能造成問題的地方。 例如，針對 ELT 處理使用預存程式不太容易遷移，而且不會包含任何中繼資料歷程，因為轉換是以程式碼來撰寫。
- 考慮一項策略，先遷移資料超市，再遵循資料超市來源的資料倉儲。 這麼做的原因是它會啟用累加式遷移，使其更容易管理，而且可以根據商務需求排定遷移優先順序。
- 在您遷移之前，考慮使用資料虛擬化來簡化您目前的資料倉儲架構，例如，將資料超市取代為虛擬資料超市，讓您可以排除資料超市的實體資料存放區和 ETL 作業，而不會在遷移之前遺失任何功能。 這麼做會減少要遷移的資料存放區數目、減少資料的複本、降低擁有權總成本並提升彈性。 這需要從實體切換到虛擬資料超市，才能遷移您的資料倉儲。 在許多方面，您可以考慮這項資料倉儲現代化步驟，再進行遷移。

## <a name="next-steps"></a>後續步驟

如需資料倉儲遷移的詳細資訊，請從 Informatica 參加[Azure 上的虛擬雲端資料倉儲現代化研討會](https://now.informatica.com/Microsoft_CDW_Workshops.html)。
