---
title: Azure 中的多個小組治理設計
description: 尋找為多個小組、多個工作負載和多個環境設定 Azure 治理控制項的指導方針。
author: alexbuckgit
ms.author: abuck
ms.date: 09/17/2019
ms.topic: conceptual
ms.service: cloud-adoption-framework
ms.subservice: govern
ms.custom: governance
ms.openlocfilehash: 96f93ad2d7a73984a69ca36235a58557eac0d1a9
ms.sourcegitcommit: 9163a60a28ffce78ceb5dc8dc4fa1b83d7f56e6d
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/17/2020
ms.locfileid: "86450487"
---
<!-- TODO: Rationalize name formats. -->

<!-- cSpell:ignore NetOps -->

# <a name="governance-design-for-multiple-teams"></a>多個小組的控管設計

本指南的目標是協助您了解在 Azure 中設計資源治理模型的程序，以支援多個小組、多個工作負載和多個環境。 首先您會查看一組假設性治理需求，然後瀏覽滿足這些需求的數個範例實作。

這些需求包括：

- 企業計劃將新的雲端角色與責任轉換給一組使用者，因此需要在 Azure 中使用不同的資源存取需求，針對多個小組進行身分識別管理。 需要身分識別管理系統來儲存下列使用者的身分識別：
  - 組織中負責**訂用帳戶**擁有權的個人。
  - 貴組織中負責將內部部署網路連線到 Azure 虛擬網路的**共用基礎結構資源**的個人。
  - 貴組織中負責管理**工作負載**的兩個個人。
- 支援多個**環境**。 環境是資源 (例如虛擬機器、虛擬網路和網路流量路由服務) 的邏輯群組。 這些資源的群組有類似的管理和安全性需求，且通常用於特定的目的，例如測試或生產環境。 在此範例中，需求適用于四個環境：
  - **共用基礎結構環境**，其中包含其他環境中工作負載共用的資源。 例如虛擬網路，具有提供與內部部署連線的閘道子網路。
  - **生產環境**，具有最嚴格的安全性原則。 可能包含內部或外部對向工作負載。
  - 用於開發和測試工作的**非生產環境**。 此環境具有與生產環境不同的安全性、合規性和成本原則。 在 Azure 中，這會採用企業開發/測試訂用帳戶的形式。
  - 適用于概念證明和教育用途的**沙箱環境**。 此環境通常會針對參與開發活動的每一位員工指派，並具有嚴格的程式和營運安全性控制措施，以避免在此登陸公司資料。 在 Azure 中，這些會採用 Visual Studio 訂用帳戶的形式。 這些訂閱也_不_應系結至企業 Azure Active Directory。
- **最低權限的權限模型**，使用者在其中預設沒有任何權限。 模型必須支援下列項目：
  - 訂用帳戶範圍中的單一受信任使用者，其處理方式就像服務帳戶，並已授與指派資源存取權限的許可權。
  - 每個工作負載擁有者預設會遭到拒絕存取資源。 資源存取權限是由資源群組範圍中的單一受信任使用者明確授與。
  - 共用基礎結構資源的管理存取權，僅限於共用的基礎結構擁有者。
  - 針對生產環境中的工作負載擁有者，每個工作負載的管理存取權，以及在開發過程中增加控制層級，以進行各種部署環境（開發、測試、預備和生產）。
  - 企業不想要在三個主要環境中各自獨立管理角色，因此需要使用 Azure 的角色型存取控制（RBAC）中可用的[內建角色](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles)。 如果企業確實需要自訂的 RBAC 角色，則需要額外的程式，才能在三個環境之間同步處理自訂角色。
- 依工作負載擁有者名稱、環境或兩者所追蹤的成本。

## <a name="identity-management"></a>身分識別管理

在您可以設計治理模型中的身分識別管理之前，請務必了解它所包含的四個主要區域：

- 系統**管理：** 用於建立、編輯和刪除使用者身分識別的進程和工具。
- **驗證：** 藉由驗證認證（例如使用者名稱和密碼）來驗證使用者識別。
- **授權：** 判斷已驗證的使用者可以存取哪些資源，或他們有權執行哪些作業。
- **審核：** 定期查看記錄檔和其他資訊，以探索與使用者身分識別相關的安全性問題。 這包括審查可疑的使用模式、定期檢查使用者權限以確認它們是否正確，以及其他功能。

Azure 只信任一個服務的身分識別，那就是 Azure Active Directory (Azure AD)。 您會將使用者新增至 Azure AD，並且針對上述所有功能使用它。 在查看如何設定 Azure AD 之前，請務必瞭解用來管理這些服務存取權的特殊許可權帳戶。

當貴組織已註冊 Azure 帳戶時，至少會指派一個 Azure **帳戶擁有者**。 此外，已建立 Azure AD **租用戶**，除非現有租用戶已與貴組織使用 Office 365 等其他 Microsoft 服務相關聯。 具有 Azure AD 租用戶完整權限的**全域管理員**，會在建立時產生關聯。

Azure 帳戶擁有者和 Azure AD 全域管理員的使用者身分識別，都會儲存在由 Microsoft 管理的高度安全身分識別系統中。 Azure 帳戶擁有者已獲授權可建立、更新和刪除訂閱。 Azure AD 全域管理員已獲授權可以在 Azure AD 中執行許多動作，但是針對這個設計指南，您將著重於使用者身分識別的建立和刪除。

> [!NOTE]
> 如果現有的 Office 365、Intune 或 Dynamics 365 授權與您的帳戶相關聯，您的組織可能已經有現有的 Azure AD 租使用者。

Azure 帳戶擁有者有權建立、更新和刪除訂閱：

![具有 Azure 帳戶擁有者和 Azure AD 全域管理員的 azure 帳戶 ](../../_images/govern/design/governance-3-0.png)
 _圖1：具有 azure 帳戶擁有者和 Azure AD 全域管理員的 azure 帳戶。_

Azure AD **全域管理員**有權可以建立使用者帳戶：

![具有 Azure 帳戶擁有者和 Azure AD 全域管理員的 azure 帳戶 ](../../_images/govern/design/governance-3-0a.png)
 _圖2： Azure AD 全域管理員會在租使用者中建立必要的使用者帳戶。_

前兩個帳戶**app1 工作負載擁有**者和**app2 工作負載擁有**者，分別與您組織中負責管理工作負載的個人相關聯。 **網路作業**帳戶是由負責共用基礎結構資源的個人所擁有。 最後，**訂用帳戶擁有者**帳戶是與負責訂用帳戶擁有權的個人相關聯。

## <a name="resource-access-permissions-model-of-least-privilege"></a>最低權限的資源存取權限模型

既然您已建立身分識別管理系統和使用者帳戶，您必須決定如何將角色型存取控制 (RBAC) 角色套用到每個帳戶，以支援最低權限的權限模型。

其他需求指出與每個工作負載相關聯的資源要彼此隔離，這樣就不會有工作負載擁有者具備並非他們擁有的其他任何工作負載的管理存取權。 此外，也需要使用 Azure 角色型存取控制的內建角色來執行此模型。

每個 RBAC 角色會在 Azure 中三個範圍的其中一個套用：**訂用帳戶**、**資源群組**，然後是個別**資源**。 角色會在較低的範圍繼承。 例如，如果在訂用帳戶層級將[內建擁有者角色](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#owner)指派給使用者，則該角色也會在資源群組和個別資源層級指派給該使用者，除非予以覆寫。

因此，若要建立最低許可權存取模型，您必須決定允許特定類型的使用者在這三個範圍中採取的動作。 例如，需求是工作負載擁有者僅有權可以管理與他們的工作負載相關聯的資源，無法管理其他工作負載。 如果您在訂用帳戶範圍指派內建擁有者角色，每個工作負載擁有者都會具有所有工作負載的管理存取權。

讓我們看看兩個範例權限模型，再稍微了解這個概念。 在第一個範例中，模型只信任服務管理員來建立資源群組。 在第二個範例中，模型在訂用帳戶範圍將內建擁有者角色指派給每個工作負載擁有者。

在這兩個範例中，有訂用帳戶服務管理員在訂用帳戶範圍獲指派內建擁有者角色。 請回想內建擁有者角色會授與所有權限，包括資源存取權的管理。

![具有擁有者角色的訂用帳戶服務管理員 ](../../_images/govern/design/governance-2-1.png)
 _圖3：具有已指派內建擁有者角色之服務管理員的訂_用帳戶。

<!-- docsTest:ignore "resource group A" "resource groups A and B" "workload owner A" -->

1. 在第一個範例中，**工作負載擁有者 A**在訂用帳戶範圍沒有許可權，且預設沒有資源存取管理許可權。 此使用者想要為其工作負載部署和管理資源。 他們必須連絡**服務管理員**以要求建立資源群組。
    ![工作負載擁有者要求建立資源群組 A](../../_images/govern/design/governance-2-2.png)
2. **服務管理員**會檢查其要求，並建立**資源群組 A**。此時，**工作負載擁有者 A**仍然沒有執行任何動作的許可權。
    ![服務管理員建立資源群組 A](../../_images/govern/design/governance-2-3.png)
3. **服務管理員**將**工作負載擁有者 A** 新增至**資源群組 A**，並指派[內建參與者角色](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#contributor)。 參與者角色授與**資源群組 A** 的所有權限，管理存取權限除外。
    ![服務管理員將工作負載擁有者 A 新增至資源群組 A](../../_images/govern/design/governance-2-4.png)
4. 假設**工作負載擁有者 a**需要一組小組成員，才能在工作負載的容量規劃中，查看 CPU 和網路流量監視資料。 因為**工作負載擁有者 A**已獲指派參與者角色，所以他們沒有許可權可以將使用者新增至**資源群組 A**。他們必須將此要求傳送給**服務管理員**。
    ![工作負載擁有者要求將工作負載參與者新增至資源群組](../../_images/govern/design/governance-2-5.png)
5. **服務管理員**會檢查要求，並將兩個**工作負載參與者**使用者新增至**資源群組 A**。這兩個使用者都不需要管理資源的許可權，因此會獲指派[內建讀者角色](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#contributor)。
    ![服務管理員將工作負載參與者新增至資源群組 A](../../_images/govern/design/governance-2-6.png)
6. 接下來，**工作負載擁有者 B** 也需要資源群組包含其工作負載的資源。 如同**工作負載擁有者 A**，**工作負載擁有者 B** 最初沒有在訂用帳戶範圍採取任何動作的權限，因此他們必須將要求傳送給**服務管理員**。
    ![工作負載擁有者 B 要求建立資源群組 B](../../_images/govern/design/governance-2-7.png)
7. **服務管理員**會檢查要求，並建立**資源群組 B**。 ![服務管理員建立資源群組 B](../../_images/govern/design/governance-2-8.png)
8. **服務管理員**接著會將**工作負載擁有者 b**新增至**資源群組 b** ，並指派內建參與者角色。
    ![服務管理員將工作負載擁有者 B 新增至資源群組 B](../../_images/govern/design/governance-2-9.png)

此時，每個工作負載擁有者會在本身的資源群組中隔離。 工作負載擁有者或其小組成員都沒有任何其他資源群組中資源的管理存取權。

![具有資源群組 A 和 B 的訂用帳戶 [ ](../../_images/govern/design/governance-2-10.png)
 _圖 4]：有兩個工作負載擁有者與自己的資源群組隔離的訂_用帳戶。

此模型是最低許可權模型。 在正確的資源管理範圍中，會為每位使用者指派正確的許可權。

請考慮此範例中的每個工作都是由**服務管理員**執行。 雖然這是簡單的範例而且可能不會造成問題，但是因為只有兩個工作負載擁有者，所以不難想像對於大型組織會造成的問題類型。 例如，**服務管理員**成為瓶頸，具有導致延遲的大量要求待處理項目。

讓我們看看第二個範例，其中減少了由**服務管理員**執行的工作數目。

1. 在此模型中，**工作負載擁有者 A**會在訂用帳戶範圍指派內建擁有者角色，讓他們能夠建立自己的資源群組：**資源群組 A**。 ![服務管理員將工作負載擁有者 A 新增至訂用帳戶](../../_images/govern/design/governance-2-11.png)
2. 當**資源群組 A** 建立時，**工作負載擁有者 A** 預設會新增，並且從訂用帳戶範圍繼承內建擁有者角色。
    ![工作負載擁有者 A 建立資源群組 A](../../_images/govern/design/governance-2-12.png)
3. 內建擁有者角色授與**工作負載擁有者 A** 管理資源群組存取權的權限。 **工作負載擁有者 A** 新增兩個**工作負載參與者**，並指派內建讀者角色給每個參與者。
    ![工作負載擁有者 A 新增工作負載參與者](../../_images/govern/design/governance-2-13.png)
4. **服務管理員**現在將**工作負載擁有者 B** 新增至具有內建擁有者角色的訂用帳戶。
    ![服務管理員將工作負載擁有者 B 新增至訂用帳戶](../../_images/govern/design/governance-2-14.png)
5. **工作負載擁有者 B** 建立**資源群組 B**，預設會新增。 同樣地，**工作負載擁有者 B** 會從訂用帳戶範圍繼承內建擁有者角色。
    ![工作負載擁有者 B 建立資源群組 B](../../_images/govern/design/governance-2-15.png)

請注意，在此模型中，**服務管理員**執行的動作比在第一個範例中還要少，原因是將管理存取權委派給個別的工作負載擁有者。

![具有資源群組 A 和 B ](../../_images/govern/design/governance-2-16.png)
 _圖5的訂用帳戶：具有服務管理員和兩個工作負載擁有者的訂用帳戶，全都指派內建擁有者角色。_

因為**工作負載擁有者 A**和**工作負載擁有者 B**在訂用帳戶範圍獲指派內建擁有者角色，所以他們會每個都繼承每個資源群組的內建擁有者角色。 這表示他們不僅擁有彼此資源的完整存取權，也可以將管理存取權委派給彼此的資源群組。 例如，**工作負載擁有者 B** 有權可以將任何其他使用者新增至**資源群組 A**，並且可以將任何角色指派給它們，包括內建擁有者角色。

如果將每個範例與需求相互比較，您會看到這兩個範例都支援在訂用帳戶範圍的單一信任使用者，有權可以將資源存取權限授與兩個工作負載擁有者。 這兩個工作負載擁有者預設都沒有資源管理存取權，需要**服務管理員**明確地將權限指派給他們。 只有第一個範例支援與每個工作負載相關聯的資源彼此隔離的需求，讓工作負載擁有者不能存取任何其他工作負載的資源。

## <a name="resource-management-model"></a>資源管理模型

既然您已經設計最低權限的權限模型，讓我們繼續查看這些治理模型的一些實際應用。 請回想需求，您必須支援下列三種環境：

1. **共用基礎結構環境：** 所有工作負載共用的一組資源。 這些資源是網路閘道、防火牆和安全性服務等等。
2. **生產環境：** 代表多個生產工作負載的多個資源群組。 這些資源是用來裝載私用和公開的應用程式成品。 這些資源通常有最嚴謹的治理和安全性模型，以防止未經授權存取資源、應用程式程式碼和資料。
3. **生產前環境：** 代表多個非生產環境就緒工作負載的多個資源群組。 這些資源是用來進行開發和測試，而且可能會有更寬鬆的治理模型，以提高開發人員的靈活性。 這些群組內的安全性應該隨著應用程式開發流程更接近生產環境而增加。

針對這三種環境，需要依**工作負載擁有者**、**環境**或兩者來追蹤成本資料。 也就是說，您會想要知道**共用基礎結構**的持續成本、**非生產**和**生產**環境中個人所產生的成本，最後是**非生產**和**生產**環境的整體成本。

您已了解資源分成兩個層級：**訂用帳戶**和**資源群組**。 因此，第一個決策是如何依據**訂用帳戶**來組織環境。 只有兩種可能性：單一訂用帳戶或多個訂閱。

在您查看每個模型的範例之前，讓我們檢閱 Azure 中訂用帳戶的管理結構。

請回想需求，您在組織中有個人負責訂用帳戶，這個使用者擁有 Azure AD 租用戶中的**訂用帳戶擁有者**帳戶。 此帳戶沒有建立訂閱的許可權。 只有 **Azure 帳戶擁有者**有權執行這個操作：

![Azure 帳戶擁有者會建立訂用帳戶 ](../../_images/govern/design/governance-3-0b.png)
 _圖6： azure 帳戶擁有者會建立訂用帳戶。_

一旦建立訂用帳戶，**Azure 帳戶擁有者**可以將**訂用帳戶擁有者**帳戶新增至具有**擁有者**角色的訂用帳戶：

![Azure 帳戶擁有者會將訂用帳戶擁有者使用者帳戶新增至具有擁有者角色的訂用帳戶。 ](../../_images/govern/design/governance-3-0c.png)
_圖7： Azure 帳戶擁有者將**訂**用帳戶擁有者使用者帳戶新增至具有**擁有**者角色的訂用帳戶。_

**訂閱擁有**者帳戶現在可以建立**資源群組**和委派資源存取管理。

首先讓我們看看使用單一訂用帳戶的範例資源管理模型。 第一個決策是如何將資源群組對齊至三個環境。 您有兩個選擇：

1. 將每個環境對齊至單一資源群組。 所有共用基礎結構資源會部署到單一**共用基礎結構**資源群組。 與開發工作負載相關聯的所有資源都會部署到單一**開發**資源群組。 與生產工作負載相關聯的所有資源都會都部署到**生產**環境的單一**生產**資源群組。
2. 建立每個工作負載的個別資源群組，使用命名慣例和標記來對齊資源群組與三個環境。

讓我們從評估第一個選項開始。 您將會使用我們在上一節中討論的權限模型，以及單一訂用帳戶服務管理員，他會建立資源群組並且將使用者新增至其中，具有內建**參與者**或**讀者**角色。

1. 所部署的第一個資源群組代表**共用基礎結構**環境。 **訂閱擁有**者帳戶會針對名為的共用基礎結構資源建立資源群組 `netops-shared-rg` 。
    ![建立資源群組](../../_images/govern/design/governance-3-0d.png)
2. **訂閱擁有**者帳戶會將**網路作業使用者**帳戶新增至資源群組，並指派「**參與者**」角色。
    ![新增網路作業使用者](../../_images/govern/design/governance-3-0e.png)
3. **網路作業使用者**會建立 [VPN 閘道](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpngateways)，並且設定它來連線到內部部署 VPN 設備。 **網路作業使用者**也會對每個資源套用一組[標記](https://docs.microsoft.com/azure/azure-resource-manager/management/tag-resources)： `environment:shared` 和 `managedBy:netOps` 。 當**訂用帳戶服務管理員**匯出成本報告時，成本會與每個標記對齊。 這可讓**訂用帳戶服務管理員**使用 `environment` 標記和標記來進行成本的樞紐分析表 `managedBy` 。 請注意圖表右上方的**資源限制**計數器。 每個 Azure 訂用帳戶具有[服務限制](https://docs.microsoft.com/azure/azure-resource-manager/management/azure-subscription-service-limits)，為了協助您了解這些限制的影響，您將遵循每個訂用帳戶的虛擬網路限制。 每個訂用帳戶的限制為 1000 個虛擬網路，在部署第一個虛擬網路之後，目前有 999 個可用。
    ![建立 VPN 閘道](../../_images/govern/design/governance-3-1.png)
4. 部署了另外兩個資源群組。 第一個名為 `prod-rg`。 此資源群組會與生產環境對齊。 第二個資源群組的名稱是 `dev-rg`，會與開發環境對齊。 與生產工作負載相關聯的所有資源都會部署至生產環境，與開發工作負載相關聯的所有資源都會部署至開發環境。 在此範例中，您只會將兩個工作負載部署到這兩個環境，這樣我們就不會遇到任何 Azure 訂用帳戶服務限制。 請考慮每個資源群組的每個資源群組都有800個資源的限制。 如果您繼續將工作負載新增至每個資源群組，您最終會達到此限制。
    ![建立資源群組](../../_images/govern/design/governance-3-2.png)
5. 第一個**工作負載擁有者**會將要求傳送給**訂用帳戶服務管理員**，並且新增至每個開發和生產環境中具有**參與者**角色的資源群組。 如同您先前所了解的，**參與者**角色允許使用者執行除了指派角色給其他使用者以外的任何作業。 第一個**工作負載擁有者**現在可以建立與其工作負載相關聯的資源。
    ![加入參與者](../../_images/govern/design/governance-3-3.png)
6. 第一個**工作負載擁有者**會在其中包含一組虛擬機器的兩個資源群組中，建立虛擬網路。 第一個**工作負載擁有**者會將 `environment` 和 `managedBy` 標記套用至所有資源。 請注意，Azure 服務限制計數器現在剩餘 997 個虛擬網路。
    ![建立虛擬網路](../../_images/govern/design/governance-3-4.png)
7. 建立時，沒有任何虛擬網路具有內部部署的連線能力。 在這種類型的架構中，每個虛擬網路都必須對等互連至 `hub-vnet` **共用基礎結構**環境中的。 虛擬網路對等互連會建立兩個不同虛擬網路之間的連線，並且允許網路流量在兩者之間傳送。 請注意，虛擬網路對等互連原本並非可轉移。 必須在每個連線的虛擬網路中指定對等互連，而且如果只有一個虛擬網路指定對等互連，則連接不完整。 為了說明這種效果，第一個**工作負載擁有**者會指定與之間的對等互連 `prod-vnet` `hub-vnet` 。 會建立第一個對等互連，但不會有流量，因為尚未指定從到的互補對等互連 `hub-vnet` `prod-vnet` 。 第一個**工作負載擁有者**會連絡**網路作業**使用者，並且要求這個互補對等互連連線。
    ![建立對等互連連線](../../_images/govern/design/governance-3-5.png)
8. **網路作業**使用者會審核要求，核准它，然後在的設定中指定對等互連 `hub-vnet` 。 對等互連連線現已完成，且網路流量會在兩個虛擬網路之間流動。
    ![建立對等互連連線](../../_images/govern/design/governance-3-6.png)
9. 現在，第二個**工作負載擁有者**會將要求傳送給**訂用帳戶服務管理員**，並且新增至現有**生產**和**開發**環境中具有**參與者**角色的資源群組。 在每個資源群組中，第二個**工作負載擁有者**具有與第一個**工作負載擁有者**相同的所有資源權限。
    ![加入參與者](../../_images/govern/design/governance-3-7.png)
10. 第二個**工作負載擁有**者會在虛擬網路中建立子網 `prod-vnet` ，然後新增兩部虛擬機器。 第二個**工作負載擁有**者會將 `environment` 和 `managedBy` 標記套用至每個資源。
    ![建立子網](../../_images/govern/design/governance-3-8.png)

這個範例資源管理模型可讓我們在三個必要的環境中管理資源。 共用基礎結構資源會受到保護，因為只有訂用帳戶中的單一使用者具有存取這些資源的許可權。 每個工作負載擁有者都可以使用共用的基礎結構資源，而不需要共用資源本身的任何許可權。 此管理模型無法滿足工作負載隔離的需求，因為這兩個**工作負載擁有**者都可以存取彼此工作負載的資源。

此模型還有一個可能無法立竿見影的重要考量。 在此範例中，它是**app1 工作負載擁有**者，其要求與的網路對等互連連線， `hub-vnet` 以提供與內部部署網路的連線。 **網路作業**使用者會根據使用該工作負載部署的資源，評估該要求。 當訂用帳戶**擁有**者帳戶新增具有**參與者**角色的**app2 工作負載擁有**者時，該使用者擁有資源群組中所有資源的管理存取權限 `prod-rg` 。

![顯示管理存取權限的圖表](../../_images/govern/design/governance-3-10.png)

這表示**app2 工作負載擁有**者有權使用虛擬網路中的虛擬機器來部署自己的子網 `prod-vnet` 。 根據預設，這些虛擬機器可以存取內部部署網路。 **網路作業**使用者並不知道這些機器，且未核准它們與內部部署的連線。

接下來，讓我們看看不同環境和工作負載中，具有多個資源群組的單一訂用帳戶。 請注意，在上一個範例中，因為每個環境的資源是在相同的資源群組中，所以它們很容易識別。 既然您不再有該群組，您必須依賴資源群組命名慣例來提供該功能。

1. **共用基礎結構**資源在此模型中仍然具有個別資源群組，所以維持不變。 每個工作負載都需要兩個資源群組，分別用於每個**開發**和**生產**環境。 針對第一個工作負載，**訂**用帳戶擁有者帳戶會建立兩個資源群組。 第一個名為 `app1-prod-rg` ，第二個名為 `app1-dev-rg` 。 如先前所述，此命名慣例會將資源識別為與第一個工作負載相關聯，以及 `app1` **開發**或**生產**環境。 同樣地，**訂**用帳戶擁有者帳戶會將**app1 工作負載擁有**者新增至具有**參與者**角色的資源群組。
    ![加入參與者](../../_images/govern/design/governance-3-12.png)
2. 類似于第一個範例， **app1 工作負載擁有**者會將名為的虛擬網路部署 `app1-prod-vnet` 到**生產**環境，並將另一個名為 `app1-dev-vnet` **開發**環境。 同樣地，**app1 工作負載擁有者**會將要求傳送給**網路作業**使用者，以建立對等互連連線。 請注意，**app1 工作負載擁有者**會新增與第一個範例相同的標記，限制計數器遞減為在訂用帳戶中剩餘 997 個虛擬網路。
    ![建立對等互連連線](../../_images/govern/design/governance-3-13.png)
3. 訂用帳戶**擁有**者帳戶現在會為**app2 工作負載擁有**者建立兩個資源群組。 遵循與**app1 工作負載擁有**者相同的慣例，資源群組會命名為 `app2-prod-rg` 和 `app2-dev-rg` 。 訂用帳戶**擁有**者帳戶會將**app2 工作負載擁有**者新增至具有**參與者**角色的每個資源群組。
    ![加入參與者](../../_images/govern/design/governance-3-14.png)
4. **App2 工作負載擁有**者帳戶會使用相同的命名慣例，將虛擬網路和虛擬機器部署到資源群組。 標記隨即新增，限制計數器遞減為在訂用帳戶中剩餘 995 個虛擬網路。
    ![部署虛擬網路和 Vm](../../_images/govern/design/governance-3-15.png)
5. **App2 工作負載擁有**者帳戶會將要求傳送給**網路作業使用者**，以將與進行對等互連 `app2-prod-vnet` `hub-vnet` 。 **網路作業**使用者會建立對等互連連線。
    ![建立對等互連連線](../../_images/govern/design/governance-3-16.png)

產生的管理模型類似於第一個範例，有幾項主要差異：

- 兩個工作負載是依據工作負載和環境來隔離。
- 此模型比起第一個範例模型還需要兩個虛擬網路。 雖然因為只有兩個工作負載，所以這不是重要的差異，但是理論上，此模型的工作負載數目限制為 24 個。
- 資源不再針對每個環境，群組在單一資源群組中。 要群組資源必須先了解針對每個環境使用的命名慣例。
- **網路作業使用者**已審查並核准每個對等互連的虛擬網路連線。

現在讓我們看看使用多個訂用帳戶的資源管理模型。 在此模型中，您會將三種環境對齊至個別的訂用帳戶：**共用服務**訂用帳戶、**生產**訂用帳戶，最後是**開發**訂用帳戶。 此模型的考量類似於使用單一訂用帳戶的模型，您在其中必須決定如何將資源群組對齊至工作負載。 已經判斷為每個工作負載建立資源群組可以滿足工作負載隔離需求，因此您在此範例中會緊緊遵循該模型。

1. 在此模型中，有三個訂用帳戶：**共用基礎結構**、**生產**和**開發**。 三個訂用帳戶都需要訂用帳戶擁有者，在範例中，您會為所有三個訂用帳戶使用相同的使用者帳戶。 **共用基礎結構**資源的管理方式類似上述前兩個範例，而第一個工作負載會與 `app1-rg` **生產**環境中的資源群組和**開發**環境中相同名稱的資源群組相關聯。 **App1 工作負載擁有**者帳戶會新增至具有**參與者**角色的每個資源群組。

    ![加入參與者](../../_images/govern/design/governance-3-17.png)

2. 如同先前的範例，app1 工作負載擁有者**** 會建立資源，並且要求與共用基礎結構**** 虛擬網路的對等互連連線。 **App1 工作負載擁有**者帳戶只 `managedBy` 會新增標記，因為已不再需要 `environment` 標記。 也就是說，每個環境的資源現在會群組在相同的**訂**用帳戶中，且 `environment` 標記是多餘的。 限制計數器會遞減為剩餘 999 個虛擬網路。

    ![建立對等互連連線](../../_images/govern/design/governance-3-18.png)

3. 最後，**訂閱擁有**者帳戶會針對第二個工作負載重複此程式，並在**參與者**角色中新增具有**app2 工作負載擁有**者的資源群組。 每個環境訂用帳戶的限制計數器會遞減為剩餘 998 個虛擬網路。

此管理模型具有上述第二個範例的優點。 主要的差別在於，限制是因為它們散佈在兩個訂用帳戶上，而不是問題。 缺點是標記追蹤的資料成本，必須跨所有三個訂用帳戶進行彙總。

因此，您可以根據您的需求優先順序，選取這兩個範例資源管理模型其中之一。 如果您預期貴組織不會達到單一訂用帳戶的服務限制，則您可以使用單一訂用帳戶與多個資源群組。 相反地，如果貴組織預期有許多工作負載，每個環境有多個訂用帳戶可能比較理想。

## <a name="implement-the-resource-management-model"></a>執行資源管理模型

您已了解用來管理 Azure 資源存取權的數個不同模型。 現在您會逐步進行所需的步驟，使用一個訂用帳戶為設計指南的每個**共用基礎結構**、**生產**和**開發**環境，實作資源管理模型。 所有三種環境都有一個訂用帳戶**擁有**者帳戶。 每個工作負載會在**資源群組**中隔離，具有新增了**參與者**角色的**工作負載擁有者**。

> [!NOTE]
> 若要深入瞭解 Azure 帳戶與訂用帳戶之間的關聯性，請參閱[瞭解 azure 中的資源存取](https://docs.microsoft.com/azure/role-based-access-control/rbac-and-directory-admin-roles)。

請遵循下列步驟：

1. 如果貴組織還沒有帳戶的話，請建立 [Azure 帳戶](https://docs.microsoft.com/azure/active-directory/sign-up-organization)。 註冊 Azure 帳戶的人員會成為 Azure 帳戶管理員，而且貴組織的領導必須選取個人來承擔這個角色。 這個個人將負責：
    - 正在建立訂閱。
    - 建立和管理[Azure Active Directory （Azure AD）](https://docs.microsoft.com/azure/active-directory/fundamentals/active-directory-whatis)租使用者，以儲存這些訂用帳戶的使用者身分識別。
2. 貴組織的領導小組決定誰負責：
    - 使用者身分識別的管理;建立組織的 Azure 帳戶時，預設會建立[Azure AD 租](https://docs.microsoft.com/azure/active-directory/develop/active-directory-howto-tenant)使用者，且帳戶管理員預設會新增為[Azure AD 全域管理員](https://docs.microsoft.com/azure/active-directory/users-groups-roles/directory-assign-admin-roles)。 貴組織可以選擇另一個使用者來管理使用者身分識別，方法是[將 Azure AD 全域管理員角色指派給該使用者](https://docs.microsoft.com/azure/active-directory/fundamentals/active-directory-users-assign-role-azure-portal)。
    - 訂用帳戶，這表示這些使用者：
        - 管理與該訂用帳戶中的資源使用量相關聯的成本。
        - 執行和維護資源存取權的最低許可權模型。
        - 持續追蹤服務限制。
    - 共用基礎結構服務 (如果貴組織決定要使用此模型)，這表示此使用者負責：
        - 內部部署至 Azure 的網路連線。
        - 透過虛擬網路對等互連，在 Azure 內網路連線的擁有權。
    - 工作負載擁有者。
3. Azure AD 全域管理員會為以下人員[建立新的使用者帳戶](https://docs.microsoft.com/azure/active-directory/add-users-azure-active-directory)：
    - 每個與每個環境相關聯的訂用帳戶將成為訂用帳戶擁有者的人員。 請注意，只有當訂用帳戶**服務管理員**不負責管理每個訂用帳戶/環境的資源存取權時，才需要這麼做。
    - 將成為**網路作業使用者**的人員。
    - 身為**工作負載擁有**者的人員。
4. Azure 帳戶管理員會使用 [Azure 帳戶入口網站](https://account.azure.com/subscriptions)，建立下列三個訂用帳戶：
    - **共用基礎結構**環境的訂用帳戶。
    - **生產**環境的訂用帳戶。
    - 適用於**開發**環境的訂用帳戶。
5. Azure 帳戶管理員會[將訂用帳戶服務擁有者新增至每個訂用帳戶](https://docs.microsoft.com/azure/billing/billing-add-change-azure-subscription-administrator#to-assign-a-user-as-an-administrator)。
6. 建立**工作負載擁有者**的核准程序，以要求建立資源群組。 核准程式可透過許多方式來執行，例如透過電子郵件，或者您可以使用程式管理工具（例如[SharePoint 工作流程](https://support.office.com/article/introduction-to-sharepoint-workflow-07982276-54e8-4e17-8699-5056eff4d9e3)）。 核准程序可以依照下列步驟：
    - **工作負載擁有者**為**開發**環境、**生產**環境或兩者中的必要 Azure 資源準備用料表，並且將它提交給**訂用帳戶擁有者**。
    - 訂用帳戶**擁有**者會審查資料的物料單，並驗證要求的資源，以確保所要求的資源適用于其規劃用途，例如檢查要求的[虛擬機器大小](https://docs.microsoft.com/azure/virtual-machines/windows/sizes)是否正確。
    - 如果要求未獲得核准，**工作負載擁有者**會收到通知。 如果要求通過核准，**訂用帳戶擁有者會遵循貴組織的[命名慣例](../../ready/azure-best-practices/naming-and-tagging.md)來** [建立要求的資源群組](https://docs.microsoft.com/azure/azure-resource-manager/manage-resource-groups-portal#create-resource-groups)，[新增**工作負載擁有者**](https://docs.microsoft.com/azure/role-based-access-control/role-assignments-portal#add-a-role-assignment)，其具有[**參與者**角色](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#contributor)，並且將通知傳送給已建立資源群組的**工作負載擁有者**。
7. 為工作負載擁有者建立核准程序，以要求來自共用基礎結構擁有者的虛擬網路對等互連連線。 如同上一個步驟，這個核准程序可以使用電子郵件或處理程序管理工具來實作。

既然您已實作治理模型，您可以部署共用基礎結構服務。

## <a name="related-resources"></a>相關資源

[適用於 Azure 資源的內建角色](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles)

## <a name="next-steps"></a>後續步驟

> [!div class="nextstepaction"]
> [了解如何部署基本基礎結構](../../infrastructure/virtual-machines/basic-workload.md)
